@model ReceptionCentreNew.Models.SourcesViewModel

<div class="card-box p-0">
    <div class="table-responsive">
        <table id="sourcesTable" class="footable journal-incoming table route-table table-td-sm table-vertical-middle mb-0" data-page-size="10" data-limit-navigation="5">
            <div class="input-group">
                <div class="input-group-prepend align-items-center">
                    <span class="px-3 text-secondary" id="basic-addon1"><i class="fa fa-search"></i></span>
                </div>
                <input type="text" id="searchTextSources" value="@ViewBag.Search" class="form-control pl-0 border-0" placeholder="Поиск ..." aria-label="Username" aria-describedby="basic-addon1" autocomplete="on">
                <div class="input-group-append align-items-center">
                    <span class="px-3 text-secondary" id="basic-addon1"><i class="md md-keyboard-return"></i></span>
                </div>
            </div>
            @if (Model.SourceModel.Any())
            {
                <tbody>
                    @{ int i = Model.PageInfo.CurrentPage*10-9;}
                    @foreach (var item in Model.SourceModel.OrderByDescending(o => o.date_add))
                    {
                        <tr>
                            <td>
                                @((Model.PageInfo.CurrentPage - 1) * Model.PageInfo.ItemsPerPage + ++Model.PageInfo.NumberRow)
                            </td>
                            <td class="vertical-middle p-l-20-important text-nowrap">                                
                                @(item.applicant_name)
                            </td>
                            <td class="vertical-middle">
                                @Html.DisplayFor(m => item.contact)
                            </td>                            
                            <td class="vertical-middle">
                                @item.date_add.Value.ToString("dd.MM.yyyy")
                                <small class="d-block text-muted">@item.date_add.Value.ToString("HH:mm:ss")</small>
                            </td>
                            <td class="vertical-middle">
                                @Html.DisplayFor(m => item.option)
                            </td>                           
                            <td class="vertical-middle p-r-20-important text-right" style="font-size: 22px;line-height: 22px;">
                                @if (item.save_ftp)
                                {
                                    <button type="button" class="btn btn-link btn-audio" data-id="@item.id"><i class="md md-play-circle-outline"></i></button>
                                }
                                @if (item.number_appeal == null)
                                {
                                    if (User.IsInRole("superadmin") || User.IsInRole("admin") || User.IsInRole("operator"))
                                    {
                                        if (item.type == ReceptionCentreNew.Models.sources_type.call)
                                        {
                                            using (Ajax.BeginForm("NewAppeal", "Appeal", new { callId = item.id, applicant_name = item.applicant_name != "Заявитель не найден!" ? item.applicant_name : "",  modal = true }, new AjaxOptions { UpdateTargetId = "newModal", OnSuccess = "$('#newModal').modal('show');" }, new { @class = "form-submit" }))
                                            {
                                                <button type="submit" title="Создать обращение на основе звонка" class="btn waves-effect waves-light btn-sm bg-custom"><i class="fa fa-plus" style="color:white;"></i></button>
                                            }                                            
                                        }
                                    }
                                }
                                else
                                {
                                    using (Ajax.BeginForm("AppealInfo", "Appeal", new { number = item.number_appeal, modal = true }, new AjaxOptions { UpdateTargetId = "newModal", OnSuccess = "$('#newModal').modal('show');" }, new { @class = "form-submit" }))
                                    {
                                        <button type="submit" title="Перейти к обращению" class="btn waves-effect waves-light btn-sm btn-danger"><i class="fa fa-chevron-right"></i></button>
                                    }
                                }
                                @if (item.type == ReceptionCentreNew.Models.sources_type.call)
                                {
                                    <button type="button" class="btn waves-effect waves-light btn-sm bg-custom" onclick="onCallModalBtnClick('@item.contact','@item.number_appeal')"><i class="md md-call" style="color:white;"></i></button>
                                }
                                @if (item.type == ReceptionCentreNew.Models.sources_type.email)
                                {
                                    using (Ajax.BeginForm("PartialModalReadEmail", "Email", new { emailId = item.id }, new AjaxOptions { UpdateTargetId = "newModal", OnSuccess = "$('#newModal').modal('show');" }, new { @class = "form-submit" }))
                                    {
                                        <button type="submit" title="Прочитать" class="btn btn-info waves-effect waves-light btn-sm"><i class="md md-chat" style="color:white;"></i></button>
                                    }
                                }
                                <button type="button" class="on-default text-custom btn btn-link btn-tooltip-info" data-tooltip-info='{ "appeal_number": "@item.number_appeal", "employees_fio": "@item.employees_name"}'>
                                    <i class="ion-ios7-information-outline"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            }
            else
            {
                <div class="alert-no-record">
                    <span style="color: #00545c;"><strong><i class="icon-info"></i></strong> По данному запросу ничего не найдено.</span>
                </div>
            }
            <tfoot>
                <tr class="tfoot-row">
                    <td colspan="3" class="text-left">
                        <div class="text-muted divider">Показаны  <span id="filter_count">@((Model.PageInfo.CurrentPage * Model.PageInfo.ItemsPerPage > Model.PageInfo.TotalItems) ? Model.PageInfo.TotalItems : Model.PageInfo.CurrentPage * Model.PageInfo.ItemsPerPage)</span> из <span id="tr_count">@Model.PageInfo.TotalItems</span> записей</div>
                    </td>
                    <td colspan="4">
                        <div class="pagination pagination-split footable-pagination justify-content-end m-t-5 m-b-5" id="datatable-editable_paginate">
                            @Html.PageLinks(Model.PageInfo, x => Ajax.ActionLink(x.NameLink, "PartialTableSources", "Sources", new { page = x.CurrentPage, search = ViewBag.Search, action_ = ViewBag.Action, sources = ViewBag.Sources, sprEmployeeId = ViewBag.SprEmployeesId, period = ViewBag.Period, is_connected = ViewBag.IsConnected }, new AjaxOptions { UpdateTargetId = "sourcesTableContainer" }))
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    <hr />
    <div id="sources_play_content">

    </div>
</div>        
        <script>
            $(document).ready(function () {
                
            });

            $(function () {
                $('button[data-tooltip-info]').tooltip({
                    title: function () {
                        var tooltipInfo = $(this).data('tooltipInfo');
                        return "<div class='text-left'>" +
                            "<strong>Номер дела:</strong> " + tooltipInfo['appeal_number'] + "</br>" +
                            "<strong>Сотрудник:</strong> " + tooltipInfo['employees_fio'] + "</br>" +
                            "</div>";
                    },
                    html: true,
                    placement: "left"
                });
            });
                        

            // Добавляем возможность выбора строки в таблице
            $('#sourcesTable tr:not(.thead-row, .tfoot-row)').click(function () {
                $(this).siblings('tr:not(.thead-row)').removeClass('active');
                $(this).addClass('active');
            });
        </script>